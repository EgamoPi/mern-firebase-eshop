{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { createElement as $, useState, useEffect } from 'react';\nimport { toast } from 'react-toastify';\nimport { Button } from 'antd';\nimport { MailOutlined, GoogleCircleFilled } from '@ant-design/icons';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Link } from 'react-router-dom';\nimport { auth, googleAuthProvider } from '../../firebase';\nimport { createOrUpdateUser } from '../../functions/auth';\n\nconst Login = ({\n  history\n}) => {\n  _s();\n\n  // Declaring states for form control\n  const [email, setEmail] = useState('j.sekretev@icloud.com');\n  const [password, setPassword] = useState('bye1234');\n  const [loading, setLoading] = useState(false); // Retrieving data from redux store\n\n  const dispatch = useDispatch();\n  const userState = useSelector(state => ({ ...state\n  })); // When component mount check if user is not already logged in, if he is, redirect him to '/'\n\n  useEffect(() => {\n    if (userState.user && userState.user.token) history.push('/');\n  }, [userState.user], []); // Function to redirect user depending on his role\n\n  const roleBaseRedirect = res => {\n    if (res.data.role === 'admin') {\n      history.push('/admin/dashboard');\n    } else {\n      history.push('/user/history');\n    }\n  }; // Handling function on form submit (email & password)\n\n\n  const handleSubmit = async e => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      const result = await auth.signInWithEmailAndPassword(email, password); // 1) Log in user with firebase\n\n      const {\n        user\n      } = result;\n      const idTokenResult = await user.getIdTokenResult(); // 2) To retrieve his token\n      // 3) Backend call to create or update a user in MongoDB based on his token\n\n      createOrUpdateUser(idTokenResult.token).then(res => {\n        // 4a) If response exist we dispatch user info to the store and redirect him according to his role\n        dispatch({\n          type: 'LOGGED_IN_USER',\n          payload: {\n            email: res.data.email,\n            name: res.data.name,\n            role: res.data.role,\n            token: idTokenResult.token\n          }\n        });\n        roleBaseRedirect(res);\n      }).catch(err => console.log(err));\n      toast.success('You are logged in'); // 4b) Notify user that he is logged in\n    } catch (error) {\n      console.log(error, loading);\n      toast.error(error.message);\n      setLoading(false);\n    }\n  }; // Handling function on form submit (Google auth)\n\n\n  const handleGoogleLogin = async () => {\n    auth.signInWithPopup(googleAuthProvider) // 1) open a new tab to login with gmail account\n    .then(async result => {\n      const {\n        user\n      } = result;\n      const idTokenResult = await user.getIdTokenResult(); // 2 Retrieve user token\n      // 3) Backend call to create or update a user in MongoDB based on his token\n\n      createOrUpdateUser(idTokenResult.token).then(res => {\n        // 4a) If response exist we dispatch user info to the store and redirect him according to his role\n        dispatch({\n          type: 'LOGGED_IN_USER',\n          payload: {\n            email: res.data.email,\n            name: res.data.name,\n            role: res.data.role,\n            token: idTokenResult.token\n          }\n        });\n        roleBaseRedirect(res);\n      }).catch(err => console.log(err));\n    }).catch(err => {\n      console.error(err);\n    });\n  };\n\n  return /*#__PURE__*/$('div', {\n    className: 'container p-5'\n  }, /*#__PURE__*/$('div', {\n    className: 'row'\n  }, /*#__PURE__*/$('div', {\n    className: 'col-md-6 offset-md-3'\n  }, /*#__PURE__*/$('h4', null, 'Login'), /*#__PURE__*/$('form', null, /*#__PURE__*/$('div', {\n    className: 'group-control'\n  }, /*#__PURE__*/$('input', {\n    type: 'email',\n    className: 'form-control',\n    value: email,\n    onChange: e => setEmail(e.target.value),\n    autoFocus: true\n  })), /*#__PURE__*/$('div', {\n    className: 'group-control'\n  }, /*#__PURE__*/$('input', {\n    type: 'password',\n    className: 'form-control',\n    value: password,\n    onChange: e => setPassword(e.target.value)\n  })), /*#__PURE__*/$('br'), /*#__PURE__*/$(Button, {\n    type: 'primary',\n    className: 'mb-3',\n    onClick: handleSubmit,\n    block: true,\n    shape: 'round',\n    icon: /*#__PURE__*/$(MailOutlined),\n    size: 'large',\n    disabled: !email || password.length < 6\n  }, 'Login with Email/Password'), /*#__PURE__*/$('br'), /*#__PURE__*/$(Button, {\n    type: 'danger',\n    className: 'mb-3',\n    onClick: handleGoogleLogin,\n    block: true,\n    shape: 'round',\n    icon: /*#__PURE__*/$(GoogleCircleFilled),\n    size: 'large'\n  }, 'Login with Google'), /*#__PURE__*/$(Link, {\n    to: '/forgot/password',\n    className: 'float-right text-danger'\n  }, 'Forgot Password')))));\n};\n\n_s(Login, \"kFAByH9jpdt2sPT4wExJeXcr5XU=\", false, function () {\n  return [useDispatch, useSelector];\n});\n\n_c = Login;\nexport default Login;\n\nvar _c;\n\n$RefreshReg$(_c, \"Login\");","map":{"version":3,"sources":["/Users/jonathann-gs/Documents/E-commerce/client/src/pages/auth/Login.js"],"names":["createElement","$","useState","useEffect","toast","Button","MailOutlined","GoogleCircleFilled","useDispatch","useSelector","Link","auth","googleAuthProvider","createOrUpdateUser","Login","history","email","setEmail","password","setPassword","loading","setLoading","dispatch","userState","state","user","token","push","roleBaseRedirect","res","data","role","handleSubmit","e","preventDefault","result","signInWithEmailAndPassword","idTokenResult","getIdTokenResult","then","type","payload","name","catch","err","console","log","success","error","message","handleGoogleLogin","signInWithPopup","className","value","onChange","target","autoFocus","onClick","block","shape","icon","size","disabled","length","to"],"mappings":"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","sourcesContent":["import { createElement as $, useState, useEffect } from 'react'\nimport { toast } from 'react-toastify'\nimport { Button } from 'antd'\nimport { MailOutlined, GoogleCircleFilled } from '@ant-design/icons'\nimport { useDispatch, useSelector } from 'react-redux'\nimport { Link } from 'react-router-dom'\nimport { auth, googleAuthProvider } from '../../firebase'\nimport { createOrUpdateUser } from '../../functions/auth'\n\nconst Login = ({ history }) => {\n  // Declaring states for form control\n  const [email, setEmail] = useState('j.sekretev@icloud.com')\n  const [password, setPassword] = useState('bye1234')\n  const [loading, setLoading] = useState(false)\n\n  // Retrieving data from redux store\n  const dispatch = useDispatch()\n  const userState = useSelector((state) => ({ ...state }))\n\n  // When component mount check if user is not already logged in, if he is, redirect him to '/'\n  useEffect(\n    () => {\n      if (userState.user && userState.user.token) history.push('/')\n    },\n    [userState.user],\n    [],\n  )\n\n  // Function to redirect user depending on his role\n  const roleBaseRedirect = (res) => {\n    if (res.data.role === 'admin') {\n      history.push('/admin/dashboard')\n    } else {\n      history.push('/user/history')\n    }\n  }\n\n  // Handling function on form submit (email & password)\n  const handleSubmit = async (e) => {\n    e.preventDefault()\n    setLoading(true)\n    try {\n      const result = await auth.signInWithEmailAndPassword(email, password) // 1) Log in user with firebase\n      const { user } = result\n      const idTokenResult = await user.getIdTokenResult() // 2) To retrieve his token\n\n      // 3) Backend call to create or update a user in MongoDB based on his token\n      createOrUpdateUser(idTokenResult.token)\n        .then((res) => {\n          // 4a) If response exist we dispatch user info to the store and redirect him according to his role\n          dispatch({\n            type: 'LOGGED_IN_USER',\n            payload: {\n              email: res.data.email,\n              name: res.data.name,\n              role: res.data.role,\n              token: idTokenResult.token,\n            },\n          })\n          roleBaseRedirect(res)\n        })\n        .catch((err) => console.log(err))\n\n      toast.success('You are logged in') // 4b) Notify user that he is logged in\n    } catch (error) {\n      console.log(error, loading)\n      toast.error(error.message)\n      setLoading(false)\n    }\n  }\n\n  // Handling function on form submit (Google auth)\n  const handleGoogleLogin = async () => {\n    auth\n      .signInWithPopup(googleAuthProvider) // 1) open a new tab to login with gmail account\n      .then(async (result) => {\n        const { user } = result\n        const idTokenResult = await user.getIdTokenResult() // 2 Retrieve user token\n\n        // 3) Backend call to create or update a user in MongoDB based on his token\n        createOrUpdateUser(idTokenResult.token)\n          .then((res) => {\n            // 4a) If response exist we dispatch user info to the store and redirect him according to his role\n            dispatch({\n              type: 'LOGGED_IN_USER',\n              payload: {\n                email: res.data.email,\n                name: res.data.name,\n                role: res.data.role,\n                token: idTokenResult.token,\n              },\n            })\n            roleBaseRedirect(res)\n          })\n          .catch((err) => console.log(err))\n      })\n      .catch((err) => {\n        console.error(err)\n      })\n  }\n\n  return $(\n    'div',\n    { className: 'container p-5' },\n    $(\n      'div',\n      { className: 'row' },\n      $(\n        'div',\n        { className: 'col-md-6 offset-md-3' },\n        $('h4', null, 'Login'),\n        $(\n          'form',\n          null,\n          $(\n            'div',\n            { className: 'group-control' },\n            $('input', {\n              type: 'email',\n              className: 'form-control',\n              value: email,\n              onChange: (e) => setEmail(e.target.value),\n              autoFocus: true,\n            }),\n          ),\n          $(\n            'div',\n            { className: 'group-control' },\n            $('input', {\n              type: 'password',\n              className: 'form-control',\n              value: password,\n              onChange: (e) => setPassword(e.target.value),\n            }),\n          ),\n          $('br'),\n          $(\n            Button,\n            {\n              type: 'primary',\n              className: 'mb-3',\n              onClick: handleSubmit,\n              block: true,\n              shape: 'round',\n              icon: $(MailOutlined),\n              size: 'large',\n              disabled: !email || password.length < 6,\n            },\n            'Login with Email/Password',\n          ),\n          $('br'),\n          $(\n            Button,\n            {\n              type: 'danger',\n              className: 'mb-3',\n              onClick: handleGoogleLogin,\n              block: true,\n              shape: 'round',\n              icon: $(GoogleCircleFilled),\n              size: 'large',\n            },\n            'Login with Google',\n          ),\n          $(\n            Link,\n            { to: '/forgot/password', className: 'float-right text-danger' },\n            'Forgot Password',\n          ),\n        ),\n      ),\n    ),\n  )\n}\n\nexport default Login\n"]},"metadata":{},"sourceType":"module"}